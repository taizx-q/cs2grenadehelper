<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS2 Grenade Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: relative;
        }

        #silk-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .content-container {
            position: relative;
            z-index: 1;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.125);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: all 0.3s ease;
        }

        .glass:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.5);
        }

        .map-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            max-height: 70vh;
            overflow: auto;
        }
        .map-image {
            width: 100%;
            height: auto;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .throw-point {
            position: absolute;
            width: 18px;
            height: 18px;
            background-color: #ef4444;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .throw-point:hover {
            transform: translate(-50%, -50%) scale(1.4);
            z-index: 10;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .throw-point.active {
            transform: translate(-50%, -50%) scale(1.6);
            background-color: #10b981;
            z-index: 20;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.3);
        }
        .throw-menu {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 12px;
            min-width: 220px;
            max-width: 220px;
            z-index: 30;
            color: #1f2937;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: scale(0.95);
            opacity: 0;
            animation: fadeIn 0.2s ease-out forwards;
        }

        @keyframes fadeIn {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        .guide-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .guide-content {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            color: white;
            padding: 32px;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .map-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            padding: 16px;
        }
        .map-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .map-card:hover {
            transform: translateY(-4px);
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <div id="silk-bg" class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900"></div>
    <div class="content-container">
    <header class="glass py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center text-green-400">
                <i class="fas fa-bomb mr-2"></i>CS2 Grenade Guide
            </h1>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div id="map-selection" class="mb-8 flex flex-col items-center justify-center min-h-[60vh]">
            <h2 class="text-2xl font-semibold mb-8 text-center">Select a Map</h2>
            <div class="map-selector w-full max-w-4xl">
                <div class="map-card glass rounded-xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105" onclick="selectMap('mirage')">
                    <img src="https://static.wikia.nocookie.net/cswikia/images/f/f5/De_mirage_cs2.png" alt="Mirage" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">Mirage</h3>
                        <p class="text-gray-300 text-sm">64 smokes available</p>
                    </div>
                </div>
                <div class="map-card glass rounded-xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105" onclick="selectMap('inferno')">
                    <img src="https://upload.wikimedia.org/wikipedia/ru/6/65/Inferno_%28CSGO%29.png" alt="Inferno" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">Inferno</h3>
                        <p class="text-gray-300 text-sm">Coming soon</p>
                    </div>
                </div>
                <div class="map-card glass rounded-xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105" onclick="selectMap('dust2')">
                    <img src="https://upload.wikimedia.org/wikipedia/en/3/3e/Csgo_dust2.jpg" alt="Dust II" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">Dust II</h3>
                        <p class="text-gray-300 text-sm">Coming soon</p>
                    </div>
                </div>
                <div class="map-card glass rounded-xl overflow-hidden shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105" onclick="selectMap('overpass')">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTd1rWdt4yXA4VQI9aVrQTq9gorXul09UO_LA&s" alt="Overpass" class="w-full h-32 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">Overpass</h3>
                        <p class="text-gray-300 text-sm">Coming soon</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="map-view" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <button onclick="backToMapSelection()" class="glass hover:bg-gray-700/70 px-4 py-2 rounded-lg flex items-center transition-all duration-300">
                    <i class="fas fa-arrow-left mr-2"></i> Back to maps
                </button>
                <h2 id="current-map-name" class="text-2xl font-semibold text-center"></h2>
                <div class="flex space-x-2">
                    <button id="add-point-btn" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-plus mr-2"></i> Add Throw Point
                    </button>
                    <button id="export-btn" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-file-export mr-2"></i> Export
                    </button>
                    <button id="import-btn" class="bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-lg flex items-center">
                        <i class="fas fa-file-import mr-2"></i> Import
                    </button>
                </div>
            </div>

            <div class="map-container">
                <img id="map-image" src="" alt="Map" class="map-image">
                <!-- Throw points will be added here dynamically -->
            </div>

            <div class="mt-8 glass p-6 rounded-xl transition-all duration-300">
                <h3 class="text-xl font-semibold mb-4">About This Map</h3>
                <p id="map-description" class="text-gray-300"></p>
            </div>
        </div>
    </main>

    <script>
        // Map data
        const maps = {
            mirage: {
                name: "Mirage",
                image: "https://abrakadabra.fun/uploads/posts/2021-12/1639271750_1-abrakadabra-fun-p-karta-bolshoi-mirazh-ks-go-1.jpg",
                description: "Mirage is one of the most popular competitive maps in CS2, featuring a balanced layout with multiple routes to bombsites. Mastering smokes and flashes is crucial for both T and CT sides.",
                throwPoints: []
            }
        };

        // Current state
        let currentMap = null;
        let isAddingPoint = false;
        let activePoint = null;
        let activeMenu = null;

        // DOM elements
        const mapSelection = document.getElementById('map-selection');
        const mapView = document.getElementById('map-view');
        const mapImage = document.getElementById('map-image');
        const currentMapName = document.getElementById('current-map-name');
        const mapDescription = document.getElementById('map-description');
        const addPointBtn = document.getElementById('add-point-btn');
        const mapContainer = document.querySelector('.map-container');

        // Select map function
        function selectMap(mapKey) {
            if (!maps[mapKey]) return;
            
            currentMap = mapKey;
            mapSelection.classList.add('hidden');
            mapView.classList.remove('hidden');
            
            // Set map info
            currentMapName.textContent = maps[mapKey].name;
            mapImage.src = maps[mapKey].image;
            mapDescription.textContent = maps[mapKey].description;
            
            // Add existing throw points
            maps[mapKey].throwPoints.forEach(point => {
                addThrowPoint(point.x, point.y, point.throws, point.id);
            });
        }

        // Back to map selection
        function backToMapSelection() {
            mapView.classList.add('hidden');
            mapSelection.classList.remove('hidden');
            
            // Clear all throw points and remove resize listeners
            document.querySelectorAll('.throw-point').forEach(el => {
                if (el._updateOnResize) {
                    window.removeEventListener('resize', el._updateOnResize);
                }
                el.remove();
            });
            if (activeMenu) activeMenu.remove();
            activePoint = null;
            activeMenu = null;
            isAddingPoint = false;
            addPointBtn.textContent = 'Add Throw Point';
            addPointBtn.className = 'bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg flex items-center';
        }

        // Toggle add point mode
        addPointBtn.addEventListener('click', () => {
            isAddingPoint = !isAddingPoint;
            
            if (isAddingPoint) {
                addPointBtn.textContent = 'Cancel Adding Point';
                addPointBtn.className = 'bg-red-600 hover:bg-red-500 px-4 py-2 rounded-lg flex items-center';
            } else {
                addPointBtn.textContent = 'Add Throw Point';
                addPointBtn.className = 'bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg flex items-center';
            }
        });

        // Handle map clicks
        mapContainer.addEventListener('click', (e) => {
            if (e.target === mapImage && isAddingPoint) {
                // Calculate position relative to the actual image (not container)
                const containerRect = mapContainer.getBoundingClientRect();
                const imageRect = mapImage.getBoundingClientRect();
                
                // Calculate the visible image area within the container
                const imageLeft = Math.max(0, (containerRect.width - imageRect.width) / 2);
                const imageTop = Math.max(0, (containerRect.height - imageRect.height) / 2);
                
                // Check if click is within the actual image bounds
                const clickX = e.clientX - containerRect.left;
                const clickY = e.clientY - containerRect.top;
                
                if (clickX < imageLeft || clickX > imageLeft + imageRect.width ||
                    clickY < imageTop || clickY > imageTop + imageRect.height) {
                    return; // Click is outside the image
                }
                
                // Calculate percentage relative to the actual image (not container)
                const x = ((clickX - imageLeft) / imageRect.width) * 100;
                const y = ((clickY - imageTop) / imageRect.height) * 100;
                
                // Ensure the point stays within image bounds (0-100%)
                const clampedX = Math.max(0, Math.min(100, x));
                const clampedY = Math.max(0, Math.min(100, y));
                
                // Generate a new ID
                const newId = maps[currentMap].throwPoints.length > 0 
                    ? Math.max(...maps[currentMap].throwPoints.map(p => p.id)) + 1
                    : 1;
                
                // Add to our data structure
                maps[currentMap].throwPoints.push({
                    id: newId,
                    x: clampedX,
                    y: clampedY,
                    throws: []
                });
                
                // Add to DOM
                addThrowPoint(clampedX, clampedY, [], newId);
                
                // Exit add point mode
                isAddingPoint = false;
                addPointBtn.textContent = 'Add Throw Point';
                addPointBtn.className = 'bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg flex items-center';
            }
        });

        // Add a throw point to the map
        function addThrowPoint(x, y, throws, id) {
            const point = document.createElement('div');
            point.className = 'throw-point';
            point.dataset.id = id;
            
            // Store percentage coordinates for repositioning
            point.dataset.x = x;
            point.dataset.y = y;
            
            // Position the point initially
            updatePointPosition(point);
            
            point.addEventListener('click', (e) => {
                e.stopPropagation();
                
                // Remove active class from all points
                document.querySelectorAll('.throw-point').forEach(p => {
                    p.classList.remove('active');
                });
                
                // Add active class to clicked point
                point.classList.add('active');
                activePoint = id;
                
                // If clicking same point, just toggle the menu
                if (activePoint === id && activeMenu) {
                    activeMenu.remove();
                    activeMenu = null;
                    point.classList.remove('active');
                    return;
                }
                
                // Remove any existing menu
                if (activeMenu) activeMenu.remove();
                
                // Create menu
                const menu = document.createElement('div');
                menu.className = 'throw-menu';
                
                // Position menu relative to the point
                updateMenuPosition(point, menu);
                
                // Add title
                const title = document.createElement('div');
                title.className = 'font-bold mb-2 text-gray-800';
                title.textContent = 'Throw Options';
                menu.appendChild(title);
                
                // Add throws
                const pointData = maps[currentMap].throwPoints.find(p => p.id == id);
                
                if (pointData.throws.length > 0) {
                    pointData.throws.forEach((throwItem, index) => {
                        menu.appendChild(createThrowMenuItem(throwItem, id, index));
                    });
                } else {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.className = 'text-gray-500 italic py-2';
                    emptyMsg.textContent = 'No throws added yet';
                    menu.appendChild(emptyMsg);
                    
                    // Close menu if empty after deletion
                    setTimeout(() => {
                        if (menu.querySelectorAll('.throw-menu > div').length === 1) {
                            menu.remove();
                            point.classList.remove('active');
                            activeMenu = null;
                        }
                    }, 0);
                }
                
                // Add "Add Throw" button
                const addThrowBtn = document.createElement('div');
                addThrowBtn.className = 'mt-2 py-2 px-2 bg-green-500 text-white rounded cursor-pointer text-center';
                addThrowBtn.textContent = 'Add New Throw';
                
                addThrowBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showAddThrowForm(id);
                });
                
                menu.appendChild(addThrowBtn);

                // Add "Delete Point" button
                const deletePointBtn = document.createElement('div');
                deletePointBtn.className = 'mt-2 py-2 px-2 bg-red-500 text-white rounded cursor-pointer text-center';
                deletePointBtn.textContent = 'Delete This Point';
                
                deletePointBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm('Are you sure you want to delete this point and all its throws?')) {
                        const pointIndex = maps[currentMap].throwPoints.findIndex(p => p.id == id);
                        if (pointIndex !== -1) {
                            maps[currentMap].throwPoints.splice(pointIndex, 1);
                            point.remove();
                            if (activeMenu) {
                                activeMenu.remove();
                                activeMenu = null;
                            }
                        }
                    }
                });
                
                menu.appendChild(deletePointBtn);
                
                // Add to DOM
                mapContainer.appendChild(menu);
                activeMenu = menu;
                
                // Update menu position on resize
                window.addEventListener('resize', function updateMenuOnResize() {
                    updateMenuPosition(point, menu);
                });
            });
            
            mapContainer.appendChild(point);

            // Close menu when clicking outside
            function closeMenu(e) {
                if (!point.contains(e.target) && (!activeMenu || !activeMenu.contains(e.target))) {
                    if (activeMenu) {
                        activeMenu.remove();
                        activeMenu = null;
                    }
                    point.classList.remove('active');
                    document.removeEventListener('click', closeMenu);
                }
            }
            document.addEventListener('click', closeMenu);
            
            // Add resize listener to keep points positioned correctly
            function updateOnResize() {
                updatePointPosition(point);
            }
            
            window.addEventListener('resize', updateOnResize);
            
            // Store the update function for cleanup if needed
            point._updateOnResize = updateOnResize;
        }

        // Update point position based on image dimensions
        function updatePointPosition(point) {
            const imageRect = mapImage.getBoundingClientRect();
            const containerRect = mapContainer.getBoundingClientRect();
            
            // Get the relative position of the image within the container
            const imageLeft = (containerRect.width - imageRect.width) / 2;
            const imageTop = (containerRect.height - imageRect.height) / 2;
            
            // Get stored percentage coordinates
            const x = parseFloat(point.dataset.x);
            const y = parseFloat(point.dataset.y);
            
            // Convert percentage coordinates to pixel positions relative to the container
            const pixelX = imageLeft + (x / 100) * imageRect.width;
            const pixelY = imageTop + (y / 100) * imageRect.height;
            
            // Set position relative to container
            point.style.left = `${pixelX}px`;
            point.style.top = `${pixelY}px`;
        }

        // Update menu position
        function updateMenuPosition(point, menu) {
            const pointRect = point.getBoundingClientRect();
            const containerRect = mapContainer.getBoundingClientRect();
            
            // Calculate position relative to container
            let left = pointRect.left - containerRect.left;
            let top = pointRect.bottom - containerRect.top;
            
            // Adjust if menu would go outside right edge
            if (left + 200 > containerRect.width) {
                left = containerRect.width - 220;
            }
            
            // Adjust if menu would go outside bottom edge
            if (top + 300 > containerRect.height) {
                top = pointRect.top - containerRect.top - 300;
            }
            
            menu.style.left = `${left}px`;
            menu.style.top = `${top}px`;
        }

        // Show throw guide modal
        function showThrowGuide(throwItem) {
            // Remove any existing modal
            const existingModal = document.querySelector('.guide-modal');
            if (existingModal) existingModal.remove();
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'guide-modal';
            
            // Create content
            const content = document.createElement('div');
            content.className = 'guide-content';
            
            // Add title
            const title = document.createElement('h3');
            title.className = 'text-2xl font-bold mb-4 text-green-400';
            title.textContent = throwItem.name;
            content.appendChild(title);
            
            // Add type badge
            const typeBadge = document.createElement('span');
            typeBadge.className = 'inline-block px-2 py-1 rounded-full text-xs font-semibold mb-4 ';
            
            if (throwItem.type === 'smoke') {
                typeBadge.className += 'bg-gray-500 text-white';
                typeBadge.textContent = 'Smoke Grenade';
            } else if (throwItem.type === 'flash') {
                typeBadge.className += 'bg-yellow-400 text-gray-900';
                typeBadge.textContent = 'Flashbang';
            } else if (throwItem.type === 'molotov') {
                typeBadge.className += 'bg-orange-500 text-white';
                typeBadge.textContent = 'Molotov/Incendiary';
            }
            
            content.appendChild(typeBadge);
            
            // Add description
            const desc = document.createElement('p');
            desc.className = 'my-4 text-gray-300';
            desc.textContent = throwItem.description;
            content.appendChild(desc);

            // Add throw image if exists and is valid URL
            if (throwItem.throwImage && throwItem.throwImage.startsWith('http')) {
                const throwImg = document.createElement('img');
                throwImg.src = throwItem.throwImage;
                throwImg.className = 'w-full h-auto mb-4 rounded';
                throwImg.alt = 'Throw position';
                throwImg.onerror = () => {
                    throwImg.remove();
                    const errorMsg = document.createElement('p');
                    errorMsg.className = 'text-red-400 text-sm mb-4';
                    errorMsg.textContent = 'Could not load throw image';
                    content.appendChild(errorMsg);
                };
                content.appendChild(throwImg);
            }

            // Add result image if exists and is valid URL
            if (throwItem.resultImage && throwItem.resultImage.startsWith('http')) {
                const resultImg = document.createElement('img');
                resultImg.src = throwItem.resultImage;
                resultImg.className = 'w-full h-auto mb-4 rounded';
                resultImg.alt = 'Result';
                resultImg.onerror = () => {
                    resultImg.remove();
                    const errorMsg = document.createElement('p');
                    errorMsg.className = 'text-red-400 text-sm mb-4';
                    errorMsg.textContent = 'Could not load result image';
                    content.appendChild(errorMsg);
                };
                content.appendChild(resultImg);
            }
            
            // Add close button
            const closeBtn = document.createElement('button');
            closeBtn.className = 'mt-4 bg-red-600 hover:bg-red-500 px-4 py-2 rounded-lg';
            closeBtn.textContent = 'Close';
            closeBtn.addEventListener('click', () => modal.remove());
            content.appendChild(closeBtn);
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show form to add a new throw
        function showAddThrowForm(pointId) {
            // Remove any existing modal
            const existingModal = document.querySelector('.guide-modal');
            if (existingModal) existingModal.remove();
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'guide-modal';
            
            // Create content
            const content = document.createElement('div');
            content.className = 'guide-content';
            
            // Add title
            const title = document.createElement('h3');
            title.className = 'text-2xl font-bold mb-4 text-green-400';
            title.textContent = 'Add New Throw';
            content.appendChild(title);
            
            // Create form
            const form = document.createElement('form');
            
            // Throw name
            const nameGroup = document.createElement('div');
            nameGroup.className = 'mb-4';
            
            const nameLabel = document.createElement('label');
            nameLabel.className = 'block text-gray-300 mb-2';
            nameLabel.textContent = 'Throw Name';
            nameGroup.appendChild(nameLabel);
            
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.className = 'w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white';
            nameInput.required = true;
            nameGroup.appendChild(nameInput);
            
            form.appendChild(nameGroup);
            
            // Throw type
            const typeGroup = document.createElement('div');
            typeGroup.className = 'mb-4';
            
            const typeLabel = document.createElement('label');
            typeLabel.className = 'block text-gray-300 mb-2';
            typeLabel.textContent = 'Grenade Type';
            typeGroup.appendChild(typeLabel);
            
            const typeSelect = document.createElement('select');
            typeSelect.className = 'w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white';
            
            const smokeOption = document.createElement('option');
            smokeOption.value = 'smoke';
            smokeOption.textContent = 'Smoke Grenade';
            typeSelect.appendChild(smokeOption);
            
            const flashOption = document.createElement('option');
            flashOption.value = 'flash';
            flashOption.textContent = 'Flashbang';
            typeSelect.appendChild(flashOption);
            
            const molotovOption = document.createElement('option');
            molotovOption.value = 'molotov';
            molotovOption.textContent = 'Molotov/Incendiary';
            typeSelect.appendChild(molotovOption);
            
            typeGroup.appendChild(typeSelect);
            form.appendChild(typeGroup);
            
            // Throw description
            const descGroup = document.createElement('div');
            descGroup.className = 'mb-4';
            
            const descLabel = document.createElement('label');
            descLabel.className = 'block text-gray-300 mb-2';
            descLabel.textContent = 'How to Throw';
            descGroup.appendChild(descLabel);
            
            const descTextarea = document.createElement('textarea');
            descTextarea.className = 'w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white';
            descTextarea.rows = 4;
            descTextarea.required = true;
            descGroup.appendChild(descTextarea);
            
            form.appendChild(descGroup);

            // Throw image URL
            const throwImgGroup = document.createElement('div');
            throwImgGroup.className = 'mb-4';
            
            const throwImgLabel = document.createElement('label');
            throwImgLabel.className = 'block text-gray-300 mb-2';
            throwImgLabel.textContent = 'Throw Image URL';
            throwImgGroup.appendChild(throwImgLabel);
            
            const throwImgInput = document.createElement('input');
            throwImgInput.type = 'text';
            throwImgInput.className = 'w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white';
            throwImgInput.placeholder = 'https://example.com/throw.jpg';
            throwImgGroup.appendChild(throwImgInput);
            
            form.appendChild(throwImgGroup);

            // Result image URL
            const resultImgGroup = document.createElement('div');
            resultImgGroup.className = 'mb-4';
            
            const resultImgLabel = document.createElement('label');
            resultImgLabel.className = 'block text-gray-300 mb-2';
            resultImgLabel.textContent = 'Result Image URL';
            resultImgGroup.appendChild(resultImgLabel);
            
            const resultImgInput = document.createElement('input');
            resultImgInput.type = 'text';
            resultImgInput.className = 'w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white';
            resultImgInput.placeholder = 'https://example.com/result.jpg';
            resultImgGroup.appendChild(resultImgInput);
            
            form.appendChild(resultImgGroup);
            
            // Submit button
            const submitBtn = document.createElement('button');
            submitBtn.type = 'submit';
            submitBtn.className = 'w-full bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg';
            submitBtn.textContent = 'Add Throw';
            form.appendChild(submitBtn);
            
            // Handle form submission
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const newThrow = {
                    name: nameInput.value,
                    type: typeSelect.value,
                    description: descTextarea.value,
                    throwImage: throwImgInput.value.trim(), // Trim whitespace from URLs
                    resultImage: resultImgInput.value.trim()
                };
                
                // Add to our data structure
                const pointIndex = maps[currentMap].throwPoints.findIndex(p => p.id == pointId);
                if (pointIndex !== -1) {
                    maps[currentMap].throwPoints[pointIndex].throws.push(newThrow);
                    
                    // Refresh the point to show the new throw
                    document.querySelector(`.throw-point[data-id="${pointId}"]`).click();
                }
                
                // Close modal
                modal.remove();
            });
            
            content.appendChild(form);
            
            // Add close button
            const closeBtn = document.createElement('button');
            closeBtn.className = 'mt-4 w-full bg-red-600 hover:bg-red-500 px-4 py-2 rounded-lg';
            closeBtn.textContent = 'Cancel';
            closeBtn.addEventListener('click', () => modal.remove());
            content.appendChild(closeBtn);
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        // Export button functionality
        document.getElementById('export-btn').addEventListener('click', () => {
            if (!currentMap) return;
            
            const data = JSON.stringify(maps[currentMap].throwPoints, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `cs2-grenades-${currentMap}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Import button functionality
        document.getElementById('import-btn').addEventListener('click', () => {
            if (!currentMap) return;
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // Sanitize the data - remove any function references that might have been accidentally serialized
                        const sanitizedData = importedData.map(point => ({
                            id: point.id,
                            x: point.x,
                            y: point.y,
                            throws: point.throws ? point.throws.map(throwItem => ({
                                name: throwItem.name,
                                type: throwItem.type,
                                description: throwItem.description,
                                throwImage: throwItem.throwImage,
                                resultImage: throwItem.resultImage
                            })) : []
                        }));
                        
                        if (Array.isArray(sanitizedData)) {
                            maps[currentMap].throwPoints = sanitizedData;
                            
                            // Clear existing points
                            document.querySelectorAll('.throw-point').forEach(el => el.remove());
                            if (activeMenu) activeMenu.remove();
                            
                            // Add new points
                            sanitizedData.forEach(point => {
                                addThrowPoint(point.x, point.y, point.throws, point.id);
                            });
                        }
                    } catch (err) {
                        alert('Error importing file: ' + err.message);
                    }
                };
                reader.readAsText(file);
            });
            
            input.click();
        });

        // Update the throw menu to include delete buttons
        function createThrowMenuItem(throwItem, pointId, index) {
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center py-2 px-2 hover:bg-gray-100 rounded cursor-pointer border-b border-gray-200 last:border-0';
            
            const itemContent = document.createElement('div');
            itemContent.className = 'flex items-center';
            
            // Add icon based on type
            const icon = document.createElement('i');
            icon.className = 'mr-2 text-sm';
            
            if (throwItem.type === 'smoke') {
                icon.className += ' fas fa-smog text-gray-500';
            } else if (throwItem.type === 'flash') {
                icon.className += ' fas fa-bolt text-yellow-400';
            } else if (throwItem.type === 'molotov') {
                icon.className += ' fas fa-fire text-orange-500';
            }
            
            itemContent.appendChild(icon);
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = throwItem.name;
            itemContent.appendChild(nameSpan);
            
            item.appendChild(itemContent);
            
            // Add delete button
            const deleteBtn = document.createElement('i');
            deleteBtn.className = 'fas fa-times text-red-500 hover:text-red-700 ml-2';
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                
                if (confirm('Are you sure you want to delete this throw?')) {
                    const pointIndex = maps[currentMap].throwPoints.findIndex(p => p.id == pointId);
                    if (pointIndex !== -1) {
                        maps[currentMap].throwPoints[pointIndex].throws.splice(index, 1);
                        
                        // Refresh the menu
                        document.querySelector(`.throw-point[data-id="${pointId}"]`).click();
                    }
                }
            });
            
            item.appendChild(deleteBtn);
            
            item.addEventListener('click', (e) => {
                if (e.target !== deleteBtn) {
                    showThrowGuide(throwItem);
                }
            });
            
            return item;
        }
    </script>
    </div>
</body>
</html>
